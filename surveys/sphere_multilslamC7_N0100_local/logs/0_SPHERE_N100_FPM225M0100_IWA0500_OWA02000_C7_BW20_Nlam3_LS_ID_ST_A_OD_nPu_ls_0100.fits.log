/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC7_N0100_local/drivers/0_SPHERE_N100_FPM225M0100_IWA0500_OWA02000_C7_BW20_Nlam3_LS_ID_ST_A_OD_nPu_ls_0100.fits.py:108: DeprecationWarning: circular_aperture is deprecated. Its new name is make_circular_aperture.
  dark_zone_mask = circular_aperture(img_owa * 2)(focal_grid) - circular_aperture(img_iwa * 2)(focal_grid)
/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC7_N0100_local/drivers/0_SPHERE_N100_FPM225M0100_IWA0500_OWA02000_C7_BW20_Nlam3_LS_ID_ST_A_OD_nPu_ls_0100.fits.py:116: DeprecationWarning: circular_aperture is deprecated. Its new name is make_circular_aperture.
  focal_plane_mask = 1 - evaluate_supersampled(circular_aperture(2 * fpm_radius), focal_mask_grid, 8)
Optimizer called with the following parameters:
{'focal_plane_mask': {'field_stop_radius': -1.0,
                      'grayscale': True,
                      'num_pix': 100,
                      'radius': 2.252},
 'image': {'bandwidth': 0.2,
           'contrast': 7,
           'iwa': 5,
           'num_wavelengths': 3,
           'owa': 20,
           'resolution': 2},
 'instrument': {'inst_name': 'SPHERE'},
 'lyot_stop': {'alignment_tolerance': 1,
               'filename': 'SPHERE/sphere_stop_ST_ALC2_nPup0100.fits',
               'num_lyot_stops': 1},
 'method': {'edge_width_for_prior': 2,
            'ending_scale': 1,
            'force_no_hermitian_symmetry': False,
            'force_no_x_mirror_symmetry': False,
            'force_no_y_mirror_symmetry': False,
            'initial_throughput_estimate': 1,
            'maximize_planet_throughput': True,
            'num_throughput_iterations': 2,
            'starting_scale': 1},
 'pupil': {'N': 100,
           'filename': 'SPHERE/pupil=vlt_btw_nPup=100.fits'},
 'solver': {'crossover': 0,
            'method': 2,
            'num_threads': 0}}

File organization:
{'analysis_dir': '/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC7_N0100_local/analysis',
 'drivers_dir': '/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC7_N0100_local/drivers',
 'input_files_dir': '/Users/mndiaye/python/aplc_optimization/masks',
 'log_dir': '/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC7_N0100_local/logs',
 'solution_dir': '/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC7_N0100_local/solutions',
 'survey_dir': '/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC7_N0100_local'}

Telescope pupil:
   Mirror symmetry in x: yes
   Mirror symmetry in y: yes

Lyot stop #0:
   Mirror symmetry in x: no
   Searching for mirror symmetric Lyot stops in x...
      Found Lyot stop #2 to fit.
Lyot stop #1:
   Mirror symmetry in x: no
   Searching for mirror symmetric Lyot stops in x...
      Found Lyot stop #3 to fit.
Lyot stop #2:
   Will be ignored due to symmetries with Lyot stops #[0]
Lyot stop #3:
   Will be ignored due to symmetries with Lyot stops #[1]
Lyot stop #0:
   Mirror symmetry in y: no
   Searching for mirror symmetric Lyot stops in y...
      Found Lyot stop #1 to fit.
Lyot stop #1:
   Will be ignored due to symmetries with Lyot stops #[0]
Lyot stop #2:
   Will be ignored due to symmetries with Lyot stops #[0]
Lyot stop #3:
   Will be ignored due to symmetries with Lyot stops #[1]

Complete APLC:
   Mirror symmetry in x: yes
   Mirror symmetry in y: yes

Starting optimization at scale 1 with 1913 variables and 14124 constraints.
Creating model...
Set parameter Username
Academic license - for non-commercial use only - expires 2023-12-14
Set parameter Crossover to value 0
Set parameter Method to value 2
Calculating and adding constraints...
Wavelength 1/3; Variable 1000/1913
Wavelength 2/3; Variable 1000/1913
Wavelength 3/3; Variable 1000/1913
Start optimization...
Gurobi Optimizer version 10.0.2 build v10.0.2rc0 (mac64[arm])

CPU model: Apple M1
Thread count: 8 physical cores, 8 logical processors, using up to 8 threads

Optimize a model with 28248 rows, 1913 columns and 54038424 nonzeros
Model fingerprint: 0x1abd2530
Coefficient statistics:
  Matrix range     [1e-12, 7e-04]
  Objective range  [1e+00, 1e+00]
  Bounds range     [1e+00, 1e+00]
  RHS range        [3e-04, 3e-04]
Presolve removed 0 rows and 0 columns (presolve time = 5s) ...
Presolve removed 0 rows and 0 columns (presolve time = 11s) ...
Presolve time: 12.42s
Presolved: 1913 rows, 30161 columns, 54040337 nonzeros
Ordering time: 0.01s

Barrier statistics:
 AA' NZ     : 1.829e+06
 Factor NZ  : 1.831e+06 (roughly 30 MB of memory)
 Factor Ops : 2.335e+09 (less than 1 second per iteration)
 Threads    : 8

                  Objective                Residual
Iter       Primal          Dual         Primal    Dual     Compl     Time
   0   1.83505548e+04  5.77578702e+02  0.00e+00 1.11e-16  1.18e+00    17s
   1   7.74581526e+03  7.68479113e+02  0.00e+00 6.82e-02  2.66e-01    18s
   2   2.28332132e+03  8.22059813e+02  0.00e+00 4.17e-02  5.24e-02    20s
   3   1.57668491e+03  8.49859791e+02  0.00e+00 2.17e-02  2.49e-02    21s
   4   1.12756238e+03  8.60560513e+02  0.00e+00 1.01e-02  8.97e-03    23s
   5   9.32937953e+02  8.72012902e+02  0.00e+00 2.95e-03  2.04e-03    25s
   6   8.99471404e+02  8.75578817e+02  0.00e+00 1.97e-03  8.32e-04    27s
   7   8.86844160e+02  8.79764493e+02  0.00e+00 5.14e-04  2.43e-04    29s
   8   8.82757636e+02  8.80925199e+02  0.00e+00 1.56e-04  6.38e-05    31s
   9   8.82002802e+02  8.81245512e+02  0.00e+00 7.21e-05  2.67e-05    33s
  10   8.81743060e+02  8.81404052e+02  2.25e-06 3.29e-05  1.20e-05    35s
  11   8.81666786e+02  8.81474647e+02  4.11e-06 1.48e-05  6.62e-06    37s
  12   8.81571828e+02  8.81508804e+02  7.23e-06 5.61e-06  2.20e-06    39s
  13   8.81551833e+02  8.81518225e+02  4.10e-06 3.21e-06  1.18e-06    40s
  14   8.81539730e+02  8.81525508e+02  3.77e-06 1.35e-06  5.00e-07    42s
  15   8.81536967e+02  8.81527749e+02  2.59e-06 7.73e-07  3.20e-07    45s
  16   8.81532154e+02  8.81530197e+02  2.26e-06 1.50e-07  6.75e-08    49s
  17   8.81530870e+02  8.81530684e+02  1.99e-06 2.98e-08  7.28e-09    54s
  18   8.81530840e+02  8.81530780e+02  2.74e-06 7.12e-09  2.60e-09    57s
  19   8.81530869e+02  8.81530800e+02  4.34e-06 2.52e-09  1.44e-09    60s
  20   8.81530812e+02  8.81530809e+02  2.06e-06 2.95e-10  3.12e-10    62s
  21   8.81530816e+02  8.81530810e+02  1.91e-06 5.46e-11  2.21e-10    64s
  22   8.81530816e+02  8.81530811e+02  1.57e-06 2.31e-13  7.11e-12    68s
  23   8.81530833e+02  8.81530811e+02  3.39e-06 2.07e-13  6.57e-12    72s
  24   8.81530826e+02  8.81530811e+02  1.55e-06 1.63e-13  2.87e-12    74s
  25   8.81530827e+02  8.81530811e+02  1.52e-06 1.87e-13  2.80e-12    76s
  26   8.81530837e+02  8.81530811e+02  1.69e-06 1.80e-13  1.03e-12    78s
  27   8.81530821e+02  8.81530811e+02  2.17e-06 1.84e-13  3.81e-13    80s
  28   8.81530809e+02  8.81530811e+02  6.62e-06 2.01e-13  3.16e-13    81s
  29   8.81530809e+02  8.81530811e+02  1.51e-06 1.42e-13  4.07e-16    83s
  30   8.81530807e+02  8.81530811e+02  1.43e-06 1.53e-13  4.78e-19    85s
  31   8.81530809e+02  8.81530811e+02  1.21e-06 1.61e-13  4.82e-19    88s
  32   8.81530811e+02  8.81530811e+02  2.74e-06 1.17e-13  3.19e-19    90s
  33   8.81530820e+02  8.81530811e+02  2.83e-06 9.56e-14  1.16e-20    92s
  34   8.81530820e+02  8.81530811e+02  3.33e-06 9.31e-14  2.94e-21    94s

Barrier solved model in 34 iterations and 93.56 seconds (129.42 work units)
Optimal objective 8.81530807e+02

Optimization finished!
Restarting optimization for throughput iteration 1...
Gurobi Optimizer version 10.0.2 build v10.0.2rc0 (mac64[arm])

CPU model: Apple M1
Thread count: 8 physical cores, 8 logical processors, using up to 8 threads

Optimize a model with 28248 rows, 1913 columns and 54038424 nonzeros
Model fingerprint: 0x09497c2e
Coefficient statistics:
  Matrix range     [1e-12, 7e-04]
  Objective range  [1e+00, 1e+00]
  Bounds range     [1e+00, 1e+00]
  RHS range        [2e-04, 2e-04]
Presolve removed 0 rows and 0 columns (presolve time = 11s) ...
Presolve time: 12.31s
Presolved: 1913 rows, 30161 columns, 54040337 nonzeros
Ordering time: 0.01s

Barrier statistics:
 AA' NZ     : 1.829e+06
 Factor NZ  : 1.831e+06 (roughly 30 MB of memory)
 Factor Ops : 2.335e+09 (less than 1 second per iteration)
 Threads    : 8

                  Objective                Residual
Iter       Primal          Dual         Primal    Dual     Compl     Time
   0   1.26594248e+04  0.00000000e+00  0.00e+00 0.00e+00  9.31e-01    16s
   1   6.73577489e+03  4.85383640e+02  0.00e+00 2.22e-16  1.95e-01    18s
   2   2.93980120e+03  5.91268480e+02  0.00e+00 2.22e-16  7.33e-02    19s
   3   1.54349299e+03  6.53068736e+02  0.00e+00 1.35e-04  2.78e-02    21s
   4   1.08249800e+03  6.92456566e+02  0.00e+00 5.41e-05  1.22e-02    23s
   5   9.12643999e+02  7.20780157e+02  0.00e+00 3.15e-05  5.99e-03    25s
   6   7.94540638e+02  7.33641806e+02  0.00e+00 1.08e-05  1.90e-03    27s
   7   7.61613544e+02  7.40586411e+02  0.00e+00 3.97e-06  6.56e-04    29s
   8   7.52000648e+02  7.44010030e+02  0.00e+00 1.48e-06  2.49e-04    31s
   9   7.49616706e+02  7.44904051e+02  0.00e+00 9.54e-07  1.47e-04    33s
  10   7.48285752e+02  7.45831935e+02  0.00e+00 4.77e-07  7.66e-05    35s
  11   7.47393982e+02  7.46070558e+02  0.00e+00 3.61e-07  4.13e-05    36s
  12   7.47071686e+02  7.46342350e+02  0.00e+00 1.99e-07  2.28e-05    38s
  13   7.46917662e+02  7.46462007e+02  0.00e+00 1.30e-07  1.42e-05    39s
  14   7.46814596e+02  7.46593633e+02  0.00e+00 5.19e-08  6.90e-06    41s
  15   7.46753086e+02  7.46666345e+02  1.05e-06 1.83e-08  2.71e-06    42s
  16   7.46724372e+02  7.46699111e+02  3.15e-06 3.81e-09  7.89e-07    44s
  17   7.46717825e+02  7.46711640e+02  6.53e-06 8.75e-10  1.92e-07    46s
  18   7.46716750e+02  7.46715221e+02  1.63e-05 1.66e-10  4.92e-08    48s
  19   7.46716651e+02  7.46716161e+02  1.25e-05 2.22e-16  1.67e-08    50s
  20   7.46716424e+02  7.46716444e+02  7.30e-06 3.33e-16  1.01e-09    53s
  21   7.46716339e+02  7.46716445e+02  7.34e-06 3.33e-16  9.40e-10    56s
  22   7.46716298e+02  7.46716453e+02  1.30e-05 2.22e-16  6.13e-10    58s
  23   7.46716317e+02  7.46716453e+02  1.57e-05 2.22e-16  5.94e-10    59s
  24   7.46716330e+02  7.46716455e+02  1.48e-05 3.33e-16  4.89e-10    61s
  25   7.46716362e+02  7.46716455e+02  1.52e-05 3.33e-16  4.82e-10    64s
  26   7.46716348e+02  7.46716456e+02  2.13e-05 2.22e-16  4.31e-10    66s
  27   7.46716491e+02  7.46716458e+02  2.99e-05 2.22e-16  3.24e-10    69s
  28   7.46716245e+02  7.46716460e+02  2.34e-05 2.22e-16  1.45e-10    71s
  29   7.46716251e+02  7.46716461e+02  2.29e-05 2.22e-16  1.21e-10    75s
  30   7.46716230e+02  7.46716461e+02  1.84e-05 3.33e-16  9.40e-11    77s
  31   7.46716268e+02  7.46716461e+02  2.83e-05 3.33e-16  8.84e-11    79s
  32   7.46716317e+02  7.46716462e+02  2.65e-05 3.33e-16  7.81e-11    82s
  33   7.46716332e+02  7.46716462e+02  1.76e-05 3.33e-16  7.24e-11    85s
  34   7.46716325e+02  7.46716462e+02  1.74e-05 3.33e-16  7.23e-11    87s
  35   7.46716359e+02  7.46716462e+02  1.54e-05 3.33e-16  7.08e-11    90s
  36   7.46716387e+02  7.46716462e+02  1.61e-05 4.90e-14  6.44e-11    92s
  37   7.46716388e+02  7.46716462e+02  1.61e-05 1.59e-13  5.97e-11    94s
  38   7.46716396e+02  7.46716462e+02  1.71e-05 1.07e-13  5.69e-11    97s
  39   7.46716400e+02  7.46716463e+02  1.55e-05 4.53e-14  4.98e-11   100s
  40   7.46716366e+02  7.46716464e+02  1.45e-05 1.08e-13  1.27e-11   104s
  41   7.46716381e+02  7.46716464e+02  1.42e-05 9.18e-14  1.00e-11   110s
  42   7.46716513e+02  7.46716464e+02  1.53e-05 1.76e-13  3.50e-12   113s
  43   7.46716494e+02  7.46716464e+02  1.52e-05 1.31e-13  3.13e-12   116s
  44   7.46716483e+02  7.46716464e+02  1.73e-05 1.35e-13  3.04e-12   119s
  45   7.46716493e+02  7.46716464e+02  1.74e-05 1.45e-13  2.39e-12   121s
  46   7.46716439e+02  7.46716464e+02  2.88e-05 1.36e-13  2.35e-12   123s
  47   7.46716369e+02  7.46716464e+02  2.42e-05 1.55e-13  1.98e-12   125s
  48   7.46716452e+02  7.46716464e+02  2.34e-05 1.82e-13  9.05e-13   127s
  49   7.46716467e+02  7.46716464e+02  2.21e-05 1.04e-13  8.51e-13   131s
  50   7.46716457e+02  7.46716464e+02  1.93e-05 1.35e-13  7.84e-13   133s
  51   7.46716455e+02  7.46716464e+02  1.58e-05 1.56e-13  4.55e-13   135s
  52   7.46716479e+02  7.46716464e+02  1.33e-05 1.65e-13  3.39e-13   137s
  53   7.46716449e+02  7.46716464e+02  1.78e-05 1.53e-13  2.44e-13   141s
  54   7.46716529e+02  7.46716464e+02  1.65e-05 1.34e-13  2.22e-13   142s
  55   7.46716626e+02  7.46716464e+02  1.35e-05 2.34e-13  6.39e-14   145s
  56   7.46716611e+02  7.46716464e+02  1.54e-05 1.56e-13  3.03e-14   147s

Barrier performed 56 iterations in 147.30 seconds (202.85 work units)
Sub-optimal termination - objective 7.46717825e+02

WARNING: VerifyWarning: Keyword name 'LS_ALIGN_TOl' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'LS_NUM_STOPS' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'PROG_START' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'PROG_EDGE' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'THRPT_ITER' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'THRPT_ESTIM' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'MAX_THRPT' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'SLV_THRDS' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'SLV_XOVER' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
Optimization finished!
