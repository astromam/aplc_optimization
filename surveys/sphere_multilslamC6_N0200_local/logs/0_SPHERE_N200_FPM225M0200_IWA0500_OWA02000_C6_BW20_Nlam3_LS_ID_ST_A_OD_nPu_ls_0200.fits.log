/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC6_N0200_local/drivers/0_SPHERE_N200_FPM225M0200_IWA0500_OWA02000_C6_BW20_Nlam3_LS_ID_ST_A_OD_nPu_ls_0200.fits.py:108: DeprecationWarning: circular_aperture is deprecated. Its new name is make_circular_aperture.
  dark_zone_mask = circular_aperture(img_owa * 2)(focal_grid) - circular_aperture(img_iwa * 2)(focal_grid)
/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC6_N0200_local/drivers/0_SPHERE_N200_FPM225M0200_IWA0500_OWA02000_C6_BW20_Nlam3_LS_ID_ST_A_OD_nPu_ls_0200.fits.py:116: DeprecationWarning: circular_aperture is deprecated. Its new name is make_circular_aperture.
  focal_plane_mask = 1 - evaluate_supersampled(circular_aperture(2 * fpm_radius), focal_mask_grid, 8)
Optimizer called with the following parameters:
{'focal_plane_mask': {'field_stop_radius': -1.0,
                      'grayscale': True,
                      'num_pix': 200,
                      'radius': 2.252},
 'image': {'bandwidth': 0.2,
           'contrast': 6,
           'iwa': 5,
           'num_wavelengths': 3,
           'owa': 20,
           'resolution': 2},
 'instrument': {'inst_name': 'SPHERE'},
 'lyot_stop': {'alignment_tolerance': 1,
               'filename': 'SPHERE/sphere_stop_ST_ALC2_nPup0200.fits',
               'num_lyot_stops': 1},
 'method': {'edge_width_for_prior': 2,
            'ending_scale': 1,
            'force_no_hermitian_symmetry': False,
            'force_no_x_mirror_symmetry': False,
            'force_no_y_mirror_symmetry': False,
            'initial_throughput_estimate': 1,
            'maximize_planet_throughput': True,
            'num_throughput_iterations': 2,
            'starting_scale': 1},
 'pupil': {'N': 200,
           'filename': 'SPHERE/pupil=vlt_btw_nPup=200.fits'},
 'solver': {'crossover': 0,
            'method': 2,
            'num_threads': 0}}

File organization:
{'analysis_dir': '/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC6_N0200_local/analysis',
 'drivers_dir': '/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC6_N0200_local/drivers',
 'input_files_dir': '/Users/mndiaye/python/aplc_optimization/masks',
 'log_dir': '/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC6_N0200_local/logs',
 'solution_dir': '/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC6_N0200_local/solutions',
 'survey_dir': '/Users/mndiaye/python/aplc_optimization/surveys/sphere_multilslamC6_N0200_local'}

Telescope pupil:
   Mirror symmetry in x: yes
   Mirror symmetry in y: yes

Lyot stop #0:
   Mirror symmetry in x: no
   Searching for mirror symmetric Lyot stops in x...
      Found Lyot stop #2 to fit.
Lyot stop #1:
   Mirror symmetry in x: no
   Searching for mirror symmetric Lyot stops in x...
      Found Lyot stop #3 to fit.
Lyot stop #2:
   Will be ignored due to symmetries with Lyot stops #[0]
Lyot stop #3:
   Will be ignored due to symmetries with Lyot stops #[1]
Lyot stop #0:
   Mirror symmetry in y: no
   Searching for mirror symmetric Lyot stops in y...
      Found Lyot stop #1 to fit.
Lyot stop #1:
   Will be ignored due to symmetries with Lyot stops #[0]
Lyot stop #2:
   Will be ignored due to symmetries with Lyot stops #[0]
Lyot stop #3:
   Will be ignored due to symmetries with Lyot stops #[1]

Complete APLC:
   Mirror symmetry in x: yes
   Mirror symmetry in y: yes

Starting optimization at scale 1 with 7658 variables and 14124 constraints.
Creating model...
Set parameter Username
Academic license - for non-commercial use only - expires 2023-12-14
Set parameter Crossover to value 0
Set parameter Method to value 2
Calculating and adding constraints...
Wavelength 1/3; Variable 1000/7658
Wavelength 1/3; Variable 2000/7658
Wavelength 1/3; Variable 3000/7658
Wavelength 1/3; Variable 4000/7658
Wavelength 1/3; Variable 5000/7658
Wavelength 1/3; Variable 6000/7658
Wavelength 1/3; Variable 7000/7658
Warning for adding constraints: zero or small (< 1e-13) coefficients, ignored
Wavelength 2/3; Variable 1000/7658
Wavelength 2/3; Variable 2000/7658
Wavelength 2/3; Variable 3000/7658
Wavelength 2/3; Variable 4000/7658
Wavelength 2/3; Variable 5000/7658
Wavelength 2/3; Variable 6000/7658
Wavelength 2/3; Variable 7000/7658
Wavelength 3/3; Variable 1000/7658
Wavelength 3/3; Variable 2000/7658
Wavelength 3/3; Variable 3000/7658
Wavelength 3/3; Variable 4000/7658
Wavelength 3/3; Variable 5000/7658
Wavelength 3/3; Variable 6000/7658
Wavelength 3/3; Variable 7000/7658
Start optimization...
Gurobi Optimizer version 10.0.2 build v10.0.2rc0 (mac64[arm])

CPU model: Apple M1
Thread count: 8 physical cores, 8 logical processors, using up to 8 threads

Optimize a model with 28248 rows, 7658 columns and 216323178 nonzeros
Model fingerprint: 0x92ede812
Coefficient statistics:
  Matrix range     [3e-13, 2e-04]
  Objective range  [1e+00, 1e+00]
  Bounds range     [1e+00, 1e+00]
  RHS range        [1e-03, 1e-03]
Presolve removed 0 rows and 0 columns (presolve time = 7s) ...
Presolve removed 0 rows and 0 columns (presolve time = 14s) ...
Presolve removed 0 rows and 0 columns (presolve time = 23s) ...
Presolve removed 0 rows and 0 columns (presolve time = 54s) ...
Presolve removed 0 rows and 0 columns (presolve time = 83s) ...
Presolve removed 0 rows and 0 columns (presolve time = 87s) ...
Presolve removed 0 rows and 0 columns (presolve time = 91s) ...
Presolve time: 96.55s
Presolved: 7658 rows, 35906 columns, 216330836 nonzeros
Ordering time: 0.13s

Barrier statistics:
 AA' NZ     : 2.932e+07
 Factor NZ  : 2.933e+07 (roughly 250 MB of memory)
 Factor Ops : 1.497e+11 (roughly 2 seconds per iteration)
 Threads    : 8

                  Objective                Residual
Iter       Primal          Dual         Primal    Dual     Compl     Time
   0   1.73636826e+05  0.00000000e+00  0.00e+00 0.00e+00  2.89e+01   134s
   1   3.18038498e+04  3.67447129e+03  0.00e+00 6.75e-03  2.93e+00   164s
   2   7.99372292e+03  4.26085866e+03  0.00e+00 1.48e-03  3.71e-01   193s
   3   5.81880577e+03  4.79533419e+03  0.00e+00 3.97e-04  1.01e-01   224s
   4   5.25936165e+03  4.97738223e+03  0.00e+00 1.11e-04  2.79e-02   255s
   5   5.15739933e+03  5.03284092e+03  0.00e+00 5.33e-05  1.24e-02   287s
   6   5.10689712e+03  5.05581017e+03  0.00e+00 2.69e-05  5.16e-03   319s
   7   5.09169911e+03  5.06744295e+03  0.00e+00 1.44e-05  2.48e-03   352s
   8   5.08521829e+03  5.07381831e+03  0.00e+00 7.82e-06  1.18e-03   385s
   9   5.08162219e+03  5.07827740e+03  0.00e+00 2.23e-06  3.47e-04   420s
  10   5.08108545e+03  5.07908381e+03  0.00e+00 1.42e-06  2.10e-04   450s
  11   5.08057769e+03  5.07997669e+03  0.00e+00 4.58e-07  6.41e-05   483s
  12   5.08051317e+03  5.08029076e+03  0.00e+00 1.55e-07  2.36e-05   515s
  13   5.08047461e+03  5.08045309e+03  0.00e+00 5.95e-09  2.20e-06   550s
  14   5.08046994e+03  5.08046801e+03  3.00e-05 2.51e-10  1.92e-07   582s
  15   5.08046941e+03  5.08046928e+03  1.28e-04 0.00e+00  1.31e-08   614s
  16   5.08046932e+03  5.08046932e+03  8.88e-05 5.32e-13  4.70e-10   651s
  17   5.08046929e+03  5.08046932e+03  2.18e-04 4.79e-13  2.51e-11   684s
  18   5.08046930e+03  5.08046932e+03  3.46e-04 4.99e-13  5.02e-11   717s
  19   5.08046934e+03  5.08046932e+03  2.82e-04 7.56e-14  3.73e-12   749s
  20   5.08046934e+03  5.08046933e+03  3.39e-04 1.23e-13  5.87e-12   788s
  21   5.08046933e+03  5.08046933e+03  6.14e-07 1.25e-13  6.07e-14   820s

Barrier solved model in 21 iterations and 819.59 seconds (662.00 work units)
Optimal objective 5.08046933e+03

Optimization finished!
Restarting optimization for throughput iteration 1...
Gurobi Optimizer version 10.0.2 build v10.0.2rc0 (mac64[arm])

CPU model: Apple M1
Thread count: 8 physical cores, 8 logical processors, using up to 8 threads

Optimize a model with 28248 rows, 7658 columns and 216323178 nonzeros
Model fingerprint: 0x09d5dd26
Coefficient statistics:
  Matrix range     [3e-13, 2e-04]
  Objective range  [1e+00, 1e+00]
  Bounds range     [1e+00, 1e+00]
  RHS range        [8e-04, 8e-04]
Presolve removed 0 rows and 0 columns (presolve time = 6s) ...
Presolve removed 0 rows and 0 columns (presolve time = 12s) ...
Presolve removed 0 rows and 0 columns (presolve time = 22s) ...
Presolve removed 0 rows and 0 columns (presolve time = 57s) ...
Presolve removed 0 rows and 0 columns (presolve time = 86s) ...
Presolve removed 0 rows and 0 columns (presolve time = 94s) ...
Presolve time: 97.36s
Presolved: 7658 rows, 35906 columns, 216330836 nonzeros
Ordering time: 0.12s

Barrier statistics:
 AA' NZ     : 2.932e+07
 Factor NZ  : 2.933e+07 (roughly 250 MB of memory)
 Factor Ops : 1.497e+11 (roughly 2 seconds per iteration)
 Threads    : 8

                  Objective                Residual
Iter       Primal          Dual         Primal    Dual     Compl     Time
   0   1.48337798e+05  0.00000000e+00  0.00e+00 0.00e+00  2.74e+01   135s
   1   3.14529221e+04  3.57037086e+03  0.00e+00 6.64e-03  2.92e+00   166s
   2   7.88835892e+03  4.11799563e+03  0.00e+00 1.62e-03  3.76e-01   197s
   3   5.72323562e+03  4.61279694e+03  0.00e+00 5.22e-04  1.10e-01   228s
   4   5.23139664e+03  4.77516992e+03  0.00e+00 1.92e-04  4.47e-02   260s
   5   5.05530241e+03  4.84708100e+03  0.00e+00 9.25e-05  2.04e-02   292s
   6   4.98062846e+03  4.87806688e+03  0.00e+00 4.90e-05  1.01e-02   324s
   7   4.93963952e+03  4.89512550e+03  0.00e+00 2.45e-05  4.41e-03   358s
   8   4.92518864e+03  4.90280057e+03  0.00e+00 1.53e-05  2.26e-03   390s
   9   4.91824307e+03  4.91006431e+03  0.00e+00 5.47e-06  8.24e-04   424s
  10   4.91560866e+03  4.91293436e+03  0.00e+00 2.07e-06  2.74e-04   457s
  11   4.91512462e+03  4.91432313e+03  0.00e+00 5.95e-07  8.19e-05   489s
  12   4.91497581e+03  4.91486750e+03  0.00e+00 5.71e-08  1.08e-05   534s
  13   4.91495660e+03  4.91494443e+03  0.00e+00 1.97e-09  1.16e-06   596s
  14   4.91495105e+03  4.91494918e+03  0.00e+00 3.15e-10  1.78e-07   658s
  15   4.91495028e+03  4.91495010e+03  3.82e-05 2.15e-11  1.63e-08   688s
  16   4.91495018e+03  4.91495017e+03  9.13e-06 6.45e-13  1.15e-09   719s
  17   4.91495018e+03  4.91495018e+03  2.75e-06 5.37e-14  5.86e-11   757s

Barrier solved model in 17 iterations and 756.70 seconds (715.72 work units)
Optimal objective 4.91495018e+03

WARNING: VerifyWarning: Keyword name 'LS_ALIGN_TOl' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'LS_NUM_STOPS' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'PROG_START' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'PROG_EDGE' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'THRPT_ITER' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'THRPT_ESTIM' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'MAX_THRPT' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'SLV_THRDS' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
WARNING: VerifyWarning: Keyword name 'SLV_XOVER' is greater than 8 characters or contains characters not allowed by the FITS standard; a HIERARCH card will be created. [astropy.io.fits.card]
Optimization finished!
